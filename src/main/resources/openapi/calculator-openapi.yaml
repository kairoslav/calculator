openapi: 3.0.3
info:
  title: Calculator Instruction Execution API
  version: 1.0.0
  description: |
    HTTP interface for submitting calculator instruction lists. The service accepts
    `calc` and `print` instructions, executes them with dependency-aware scheduling,
    and returns the values requested by the `print` statements.
servers:
  - url: http://localhost:8080
    description: Local development server
tags:
  - name: calculator
    description: Everything about your Pets
paths:
  /api/v1/executions:
    post:
      tags:
        - calculator
      summary: Execute a list of instructions
      description: |
        Accepts a strictly ordered list of calculator instructions, executes the
        dependent arithmetic operations, and returns the values requested by each
        `print` instruction.
      operationId: executeProgram
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExecuteProgramRequest'
            examples:
              sample1:
                summary: Two step program
                value:
                  instructions:
                    - type: calc
                      op: +
                      var: x
                      left: 1
                      right: 2
                    - type: print
                      var: x
              sample2:
                summary: Program with dependencies
                value:
                  instructions:
                    - type: calc
                      op: +
                      var: x
                      left: 10
                      right: 2
                    - type: print
                      var: x
                    - type: calc
                      op: '-'
                      var: y
                      left: x
                      right: 3
                    - type: calc
                      op: '*'
                      var: z
                      left: x
                      right: y
                    - type: print
                      var: w
                    - type: calc
                      op: '*'
                      var: w
                      left: z
                      right: 0
      responses:
        '200':
          description: Successfully executed and collected print results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecuteProgramResponse'
              examples:
                sample1:
                  value:
                    items:
                      - var: x
                        value: 3
                sample2:
                  value:
                    items:
                      - var: x
                        value: 12
                      - var: w
                        value: 0
        '400':
          description: Invalid instruction list (unknown variable, duplicates, etc.)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Unexpected server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  schemas:
    ExecuteProgramRequest:
      type: object
      properties:
        instructions:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/Instruction'
      required:
        - instructions
    Instruction:
      properties:
        type:
          $ref: '#/components/schemas/InstructionType'
      oneOf:
        - $ref: '#/components/schemas/CalcInstruction'
        - $ref: '#/components/schemas/PrintInstruction'
      discriminator:
        propertyName: type
        mapping:
          calc: '#/components/schemas/CalcInstruction'
          print: '#/components/schemas/PrintInstruction'
    CalcInstruction:
      type: object
      required:
        - type
        - op
        - var
        - left
        - right
      properties:
        type:
          $ref: '#/components/schemas/InstructionType'
        op:
          $ref: '#/components/schemas/Operation'
        var:
          $ref: '#/components/schemas/VariableName'
        left:
          type: integer
          format: int64
        right:
          type: integer
          format: int64
    PrintInstruction:
      type: object
      required:
        - type
        - var
      properties:
        type:
          $ref: '#/components/schemas/InstructionType'
        var:
          $ref: '#/components/schemas/VariableName'
    InstructionType:
      type: string
      description: Instruction type
      enum:
        - calc
        - print
    Operation:
      type: string
      description: Arithmetic operator supported by the service
      enum: ['+', '-', '*']
    VariableName:
      type: string
      description: Identifier of a variable created by previous `calc` operations
      pattern: '^[A-Za-z_][A-Za-z0-9_]*$'
    ExecuteProgramResponse:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          description: Values collected for each `print` instruction
          items:
            $ref: '#/components/schemas/PrintedValue'
    PrintedValue:
      type: object
      required:
        - var
        - value
      properties:
        var:
          $ref: '#/components/schemas/VariableName'
        value:
          type: integer
          format: int64
    ErrorResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
        details:
          type: array
          items:
            type: string
